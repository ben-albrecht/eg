/*
  MathWorkersJS
  @version 1.1.0
  @author Adrian W. Lange
*/
(function(){var x=function(){function x(){var a={};this.on=function(d,c){h.util.checkFunction(c);a[d]=[c]};this.emit=function(d,c){a[d]=a[d]||[];c=c||[];a[d].forEach(function(b){b.call(this,c)})}}var h={Global:{}},l={version:"1.1.0"};h.Global.getVersion=function(){return l.version};l.workerPool=[];l.nWorkers=1;l.myWorkerId=0;l.logLevel=1;h.Global.setLogLevel=function(a){h.util.nullOrUndefined(a)||(l.logLevel=a)};l.unrollLoops=!1;h.Global.setUnrollLoops=function(a){h.util.checkNullOrUndefined(a);l.unrollLoops=
a};l.createPool=function(a,d){function c(b){return{handle:"_init",id:b,nWorkers:a,logLevel:l.logLevel,unrollLoops:l.unrollLoops}}var b,e;if(l.isNode)if(l.nodeCluster=require("cluster"),l.nodeCluster.isMaster)for(b=0;b<a;++b)e=l.nodeCluster.fork(),e.send(c(b)),this.workerPool.push(e),this.nWorkers=this.workerPool.length;else l.nodeCluster.isWorker&&require(d);else for(h.util.checkWebWorkerSupport(),b=0;b<a;++b)e=new Worker(d),e.postMessage(c(b)),this.workerPool.push(e),this.nWorkers=this.workerPool.length;
this.getWorker=function(b){return this.workerPool[b]}};l.isNode=!1;l.nodeCluster={};h.Global.setNode=function(a){h.util.checkNullOrUndefined(a);l.isNode=a};h.Global.isMaster=function(){return l.isNode&&l.nodeCluster&&l.nodeCluster.isMaster};h.Global.isWorker=function(){return l.isNode&&l.nodeCluster&&l.nodeCluster.isWorker};h.util={};h.util.checkWebWorkerSupport=function(){if("undefined"===typeof Worker)throw Error("Web Worker support not available for MathWorkers.");};h.util.loadBalance=function(a){var d=
l.myWorkerId,c=a/l.nWorkers|0;a%=l.nWorkers;d<a?(d*=c+1,c=d+c+1):(d=d*c+a,c=d+c);return{ifrom:d,ito:c}};h.util.nullOrUndefined=function(a){return void 0===a||null===a};h.util.checkNullOrUndefined=function(a){if(h.util.nullOrUndefined(a))throw new TypeError("Undefined or null variable.");};h.util.checkNumber=function(a){h.util.checkNullOrUndefined(a);if("number"!=typeof a)throw new TypeError("Expected type Number but is type "+typeof a);};h.util.checkFunction=function(a){h.util.checkNullOrUndefined(a);
if("function"!=typeof a)throw new TypeError("Expected type Function but is type "+typeof a);};h.util.checkArray=function(a){h.util.checkNullOrUndefined(a);if(!(a instanceof Array||a instanceof Float64Array))throw new TypeError("Expected type Array but is type "+typeof a);};h.util.checkFloat64Array=function(a){h.util.checkNullOrUndefined(a);if(!(a instanceof Float64Array))throw new TypeError("Expected type Float64Array but is type "+typeof a);};h.util.checkVector=function(a){h.util.checkNullOrUndefined(a);
if(!(a instanceof h.Vector))throw new TypeError("Expected type Vector but is not.");};h.util.checkVectors=function(a,d){h.util.checkVector(a);h.util.checkVector(d);if(a.length!==d.length)throw Error("Vectors have unequal lengths.");};h.util.checkVectorMatrix=function(a,d){h.util.checkVector(a);h.util.checkMatrix(d);if(a.length!==d.nrows)throw Error("Vector length and number Matrix rows are unequal.");};h.util.checkMatrix=function(a){h.util.checkNullOrUndefined(a);if(!(a instanceof h.Matrix))throw new TypeError("Expected type Matrix but is not.");
};h.util.checkMatrices=function(a,d){h.util.checkMatrix(a);h.util.checkMatrix(d);if(a.nrows!==d.nrows||a.ncols!==d.ncols)throw Error("Matrices do not have equal numbers of rows and columns.");};h.util.checkMatrixVector=function(a,d){h.util.checkMatrix(a);h.util.checkVector(d);if(d.length!==a.ncols)throw Error("Vector length and number Matrix columns are unequal.");};h.util.checkMatrixMatrix=function(a,d){h.util.checkMatrix(a);h.util.checkMatrix(d);if(a.ncols!==d.nrows)throw Error("Matrices do not have compatible dimensions for matrix-matrix multiplication.");
};h.util.mapValues=function(a){var d=[],c;for(c in a)a.hasOwnProperty(c)&&d.push(a[c]);return d};h.util.ab2str=function(a){return String.fromCharCode.apply(null,new Uint16Array(a))};h.util.str2ab=function(a){for(var d=new ArrayBuffer(2*a.length),c=new Uint16Array(d),b=0,e=a.length;b<e;b++)c[b]=a.charCodeAt(b);return d};var u={postMessage:function(a,d){2<l.logLevel&&console.log("Posting message: %j",a);l.isNode?process.send({data:a}):self.postMessage(a,d)},postMessageToWorker:function(a,d,c){a=l.getWorker(a);
l.isNode?a.send({data:d}):a.postMessage(d,c)},setOnMessage:function(a){if(l.isNode)process.on("message",a);else self.onmessage=a}};h.Coordinator=function(a,d){var c=this,b={},e=[];this.ready=!1;this.onReady=function(b){c.on("_ready",b)};this.getBuffer=function(){return b};this.getMessageDataList=function(){return e};this.trigger=function(b,c){for(var a=0;a<l.nWorkers;++a)u.postMessageToWorker(a,{handle:"_trigger",tag:b,args:c})};this.sendDataToWorkers=function(b,c){for(var a=0;a<l.nWorkers;++a)u.postMessageToWorker(a,
{handle:"_broadcastData",tag:c,data:b})};this.sendVectorToWorkers=function(b,c){for(var a=0;a<l.nWorkers;++a){var e;e=l.isNode?h.util.ab2str(b.array.buffer):(new Float64Array(b.array)).buffer;u.postMessageToWorker(a,{handle:"_broadcastVector",tag:c,vec:e},[e])}};this.sendMatrixToWorkers=function(b,c){for(var a=0;a<l.nWorkers;++a){var e={handle:"_broadcastMatrix",tag:c,nrows:b.nrows},d=[],f,g;if(l.isNode)for(f=0;f<b.nrows;++f)e[f]=h.util.ab2str(b.array[f].buffer);else for(f=0;f<b.nrows;++f)g=new Float64Array(b.array[f]),
e[f]=g.buffer,d.push(g.buffer);u.postMessageToWorker(a,e,d)}};this.disconnect=function(){l.isNode&&l.nodeCluster.isMaster&&l.nodeCluster.disconnect()};l.createPool(a,d);for(var k=function(a){a=a.data||a;switch(a.handle){case "_workerReady":f+=1;f==l.nWorkers&&(c.ready=!0,c.emit("_ready"),f=0);break;case "_sendData":e[a.id]=a.data;f+=1;f==l.nWorkers&&(c.emit(a.tag),f=0);break;case "_vectorSendToCoordinator":b=new h.Vector;var d=a.vectorBuffer;l.isNode&&(d=h.util.str2ab(d));b.setVector(new Float64Array(d));
c.emit(a.tag);break;case "_gatherVector":0==f&&(b=new h.Vector(a.len));for(var d=l.isNode?h.util.str2ab(a.vectorPart):a.vectorPart,d=new Float64Array(d),g=a.offset,k=0;k<d.length;++k)b.array[g+k]=d[k];f+=1;f==l.nWorkers&&(a.rebroadcast?c.sendVectorToWorkers(b,a.tag):c.emit(a.tag),f=0);break;case "_matrixSendToCoordinator":d=[];if(l.isNode)for(g=0;g<a.nrows;++g)d.push(new Float64Array(h.util.str2ab(a[g])));else for(g=0;g<a.nrows;++g)d.push(new Float64Array(a[g]));b=new h.Matrix;b.setMatrix(d);c.emit(a.tag);
break;case "_gatherMatrixRows":d=a.offset;0==f&&(b=new h.Matrix(a.nrows,a.ncols));if(l.isNode)for(g=0;g<a.nrowsPart;++g)b.array[d+g]=new Float64Array(h.util.str2ab(a[g]));else for(g=0;g<a.nrowsPart;++g)b.array[d+g]=new Float64Array(a[g]);f+=1;f==l.nWorkers&&(a.rebroadcast?c.sendMatrixToWorkers(b,a.tag):c.emit(a.tag),f=0);break;case "_gatherMatrixColumns":0==f&&(b=new h.Matrix(a.nrows,a.ncols));var r;if(l.isNode)for(g=0,r=a.offset;g<a.nrowsPart;++g,++r)for(k=new Float64Array(h.util.str2ab(a[g])),d=
0;d<k.length;++d)b.array[d][r]=k[d];else for(g=0,r=a.offset;g<a.nrowsPart;++g,++r)for(k=new Float64Array(a[g]),d=0;d<k.length;++d)b.array[d][r]=k[d];f+=1;f==l.nWorkers&&(a.rebroadcast?c.sendMatrixToWorkers(b,a.tag):c.emit(a.tag),f=0);break;case "_vectorSum":b=0==f?a.tot:b+a.tot;f+=1;f==l.nWorkers&&(a.rebroadcast?c.sendDataToWorkers(b,a.tag):c.emit(a.tag),f=0);break;case "_vectorProduct":b=0==f?a.tot:b*a.tot;f+=1;f==l.nWorkers&&(a.rebroadcast?c.sendDataToWorkers(b,a.tag):c.emit(a.tag),f=0);break;default:console.error("Invalid Coordinator handle: "+
a)}},g=0;g<l.nWorkers;++g){if(l.isNode){if(l.nodeCluster.isWorker)return;l.getWorker(g).on("message",k)}else l.getWorker(g).onmessage=k;e.push({})}var f=0};h.Coordinator.prototype=new x;h.MathWorker=function(){var a={},d={};this.getId=function(){return l.myWorkerId};this.getNumWorkers=function(){return l.nWorkers};this.getBuffer=function(){return a};this.on=function(b,a){2<l.logLevel&&console.log("registering trigger: "+b);d[b]=[a]};this.sendDataToCoordinator=function(b,a){u.postMessage({handle:"_sendData",
id:l.myWorkerId,tag:a,data:b})};this.sendVectorToCoordinator=function(b,a){if(0==l.myWorkerId){var c=b.array.buffer;l.isNode&&(c=h.util.ab2str(c));u.postMessage({handle:"_vectorSendToCoordinator",tag:a,vectorBuffer:c},[c])}};this.sendMatrixToCoordinator=function(b,a){if(0==l.myWorkerId){var c={handle:"_matrixSendToCoordinator",tag:a,nrows:b.nrows},d=[],f;if(l.isNode)for(f=0;f<b.nrows;++f)c[f]=h.util.ab2str(b.array[f].buffer);else for(f=0;f<b.nrows;++f)c[f]=b.array[f].buffer,d.push(b.array[f].buffer);
u.postMessage(c,d)}};u.setOnMessage(function(b){b=b.data||b;switch(b.handle){case "_init":l.myWorkerId=b.id;l.nWorkers=b.nWorkers;l.unrollLoops=b.unrollLoops;l.logLevel=b.logLevel;2<l.logLevel&&console.log("Initialized MathWorker: "+l.myWorkerId+" of "+l.nWorkers+" workers.");u.postMessage({handle:"_workerReady"});break;case "_trigger":c(b);break;case "_broadcastData":a=b.data;c(b);break;case "_broadcastVector":var d=b.vec;l.isNode&&(d=h.util.str2ab(d));a=h.Vector.fromArray(new Float64Array(d));c(b,
a);break;case "_broadcastMatrix":var d=[],k;if(l.isNode)for(k=0;k<b.nrows;++k)d.push(new Float64Array(h.util.str2ab(b[k])));else for(k=0;k<b.nrows;++k)d.push(new Float64Array(b[k]));a=new h.Matrix;a.setMatrix(d);c(b,a);break;default:console.error("Invalid MathWorker handle: "+b.handle)}});var c=function(b,a){if(d[b.tag]){d[b.tag]=d[b.tag]||[];var c=b.data||a||[];d[b.tag].forEach(function(b){b.call(this,c)})}else console.error("Unregistered trigger tag: "+b.tag)}};h.MathWorker.prototype=new x;h.MathWorker.gatherVector=
function(a,d,c,b,e){e=e||!1;a=l.isNode?h.util.ab2str(a.buffer):a.buffer;u.postMessage({handle:"_gatherVector",tag:b,id:l.myWorkerId,rebroadcast:e,len:d,offset:c,vectorPart:a},[a])};h.MathWorker.gatherMatrixRows=function(a,d,c,b,e){d={handle:"_gatherMatrixRows",tag:b,id:l.myWorkerId,rebroadcast:e||!1,nrows:d,ncols:a[0].length,nrowsPart:a.length,offset:c};c=[];if(l.isNode)for(b=0;b<a.length;++b)d[b]=h.util.ab2str(a[b].buffer);else for(b=0;b<a.length;++b)d[b]=a[b].buffer,c.push(a[b].buffer);u.postMessage(d,
c)};h.MathWorker.gatherMatrixColumns=function(a,d,c,b,e,k){d={handle:"_gatherMatrixColumns",tag:e,id:l.myWorkerId,rebroadcast:k||!1,nrows:d,ncols:c,nrowsPart:a.length,offset:b};c=[];if(l.isNode)for(b=0;b<a.length;++b)d[b]=h.util.ab2str(a[b].buffer);else for(b=0;b<a.length;++b)d[b]=a[b].buffer,c.push(a[b].buffer);u.postMessage(d,c)};h.MathWorker.reduceVectorSum=function(a,d,c){u.postMessage({handle:"_vectorSum",tag:d,rebroadcast:c||!1,tot:a})};h.MathWorker.reduceVectorProduct=function(a,d,c){u.postMessage({handle:"_vectorProduct",
tag:d,rebroadcast:c||!1,tot:a})};h.Vector=function(a){this.array=null;this.length=a||0;0<a&&(this.array=new Float64Array(a))};h.Vector.fromArray=function(a){h.util.checkArray(a);for(var d=new h.Vector(a.length),c=0,b=a.length;c<b;++c)d.array[c]=a[c];return d};h.Vector.prototype.setVector=function(a){h.util.checkFloat64Array(a);this.array=a;this.length=a.length};h.Vector.zeroes=function(a){for(var d=new h.Vector(a),c=0;c<a;++c)d.array[c]=0;return d};h.Vector.randomVector=function(a){for(var d=new h.Vector(a),
c=0;c<a;++c)d.array[c]=Math.random();return d};h.Vector.prototype.toString=function(){for(var a="[",d=0;d<this.length-1;++d)a+=this.array[d]+", ";return a+this.array[this.length-1]+"]"};h.Vector.prototype.sum=function(){var a=0,d,c=this.length;if(l.unrollLoops){var b=c-3;for(d=0;d<b;d+=4)a+=this.array[d]+this.array[d+1]+this.array[d+2]+this.array[d+3]}else d=0;for(;d<c;++d)a+=this.array[d];return a};h.Vector.prototype.product=function(){var a=1,d,c=this.length;if(l.unrollLoops){var b=c-3;for(d=0;d<
b;d+=4)a=a*this.array[d]*this.array[d+1]*this.array[d+2]*this.array[d+3]}else d=0;for(;d<c;++d)a*=this.array[d];return a};h.Vector.prototype.plus=function(a){h.util.checkVectors(this,a);var d=new h.Vector(this.length),c,b=this.length;if(l.unrollLoops){var e=b-3;for(c=0;c<e;c+=4)d.array[c]=this.array[c]+a.array[c],d.array[c+1]=this.array[c+1]+a.array[c+1],d.array[c+2]=this.array[c+2]+a.array[c+2],d.array[c+3]=this.array[c+3]+a.array[c+3]}else c=0;for(;c<b;++c)d.array[c]=this.array[c]+a.array[c];return d};
h.Vector.prototype.minus=function(a){h.util.checkVectors(this,a);var d=new h.Vector(this.length),c,b=this.length;if(l.unrollLoops){var e=b-3;for(c=0;c<e;c+=4)d.array[c]=this.array[c]-a.array[c],d.array[c+1]=this.array[c+1]-a.array[c+1],d.array[c+2]=this.array[c+2]-a.array[c+2],d.array[c+3]=this.array[c+3]-a.array[c+3]}else c=0;for(;c<b;++c)d.array[c]=this.array[c]-a.array[c];return d};h.Vector.prototype.times=function(a){h.util.checkVectors(this,a);var d=new h.Vector(this.length),c,b=this.length;
if(l.unrollLoops){var e=b-3;for(c=0;c<e;c+=4)d.array[c]=this.array[c]*a.array[c],d.array[c+1]=this.array[c+1]*a.array[c+1],d.array[c+2]=this.array[c+2]*a.array[c+2],d.array[c+3]=this.array[c+3]*a.array[c+3]}else c=0;for(;c<b;++c)d.array[c]=this.array[c]*a.array[c];return d};h.Vector.prototype.divide=function(a){h.util.checkVectors(this,a);var d=new h.Vector(this.length),c,b=this.length;if(l.unrollLoops){var e=b-3;for(c=0;c<e;c+=4)d.array[c]=this.array[c]/a.array[c],d.array[c+1]=this.array[c+1]/a.array[c+
1],d.array[c+2]=this.array[c+2]/a.array[c+2],d.array[c+3]=this.array[c+3]/a.array[c+3]}else c=0;for(;c<b;++c)d.array[c]=this.array[c]/a.array[c];return d};h.Vector.prototype.scale=function(a){h.util.checkNumber(a);var d=new h.Vector(this.length),c,b=this.length;if(l.unrollLoops){var e=b-3;for(c=0;c<e;c+=4)d.array[c]=this.array[c]*a,d.array[c+1]=this.array[c+1]*a,d.array[c+2]=this.array[c+2]*a,d.array[c+3]=this.array[c+3]*a}else c=0;for(;c<b;++c)d.array[c]=this.array[c]*a;return d};h.Vector.prototype.apply=
function(a){h.util.checkFunction(a);var d=new h.Vector(this.length),c,b=this.length;if(l.unrollLoops){var e=b-3;for(c=0;c<e;c+=4)d.array[c]=a(this.array[c]),d.array[c+1]=a(this.array[c+1]),d.array[c+2]=a(this.array[c+2]),d.array[c+3]=a(this.array[c+3])}else c=0;for(;c<b;++c)d.array[c]=a(this.array[c]);return d};h.Vector.prototype.dotVector=function(a){h.util.checkVectors(this,a);var d,c=this.length,b=0;if(l.unrollLoops){var e=c-3;for(d=0;d<e;d+=4)b+=this.array[d]*a.array[d]+this.array[d+1]*a.array[d+
1]+this.array[d+2]*a.array[d+2]+this.array[d+3]*a.array[d+3]}else d=0;for(;d<c;++d)b+=this.array[d]*a.array[d];return b};h.Vector.prototype.dotMatrix=function(a){h.util.checkVectorMatrix(this,a);var d,c,b,e=a.ncols,k=this.length,g=new h.Vector(e);if(l.unrollLoops){var f=k-3;for(d=0;d<e;++d){for(c=b=0;c<f;c+=4)b+=this.array[c]*a.array[c][d]+this.array[c+1]*a.array[c+1][d]+this.array[c+2]*a.array[c+2][d]+this.array[c+3]*a.array[c+3][d];for(;c<k;++c)b+=this.array[c]*a.array[c][d];g.array[d]=b}}else for(d=
0;d<e;++d){for(c=b=0;c<k;++c)b+=this.array[c]*a.array[c][d];g.array[d]=b}return g};h.Vector.prototype.workerSum=function(a,d){h.util.checkNullOrUndefined(a);var c=h.util.loadBalance(this.length),b=0,e;if(l.unrollLoops){var k=c.ito-3;for(e=c.ifrom;e<k;++e)b+=this.array[e]+this.array[e+1]+this.array[e+2]+this.array[e+3]}else e=c.ifrom;for(;e<c.ito;++e)b+=this.array[e];h.MathWorker.reduceVectorSum(b,a,d)};h.Vector.prototype.workerProduct=function(a,d){h.util.checkNullOrUndefined(a);var c=h.util.loadBalance(this.length),
b=1,e;if(l.unrollLoops){var k=c.ito-3;for(e=c.ifrom;e<k;++e)b=b*this.array[e]*this.array[e+1]*this.array[e+2]*this.array[e+3]}else e=c.ifrom;for(;e<c.ito;++e)b*=this.array[e];h.MathWorker.reduceVectorProduct(b,a,d)};h.Vector.prototype.workerPlus=function(a,d,c){h.util.checkVectors(this,a);h.util.checkNullOrUndefined(d);var b=h.util.loadBalance(this.length),e=new Float64Array(b.ito-b.ifrom),k=0,g;if(l.unrollLoops){var f=b.ito-3;for(g=b.ifrom;g<f;++g)e[k++]=this.array[g]+a.array[g],e[k++]=this.array[g+
1]+a.array[g+1],e[k++]=this.array[g+2]+a.array[g+2],e[k++]=this.array[g+3]+a.array[g+3]}else g=b.ifrom;for(;g<b.ito;++g)e[k++]=this.array[g]+a.array[g];h.MathWorker.gatherVector(e,this.length,b.ifrom,d,c)};h.Vector.prototype.workerMinus=function(a,d,c){h.util.checkVectors(this,a);h.util.checkNullOrUndefined(d);var b=h.util.loadBalance(this.length),e=new Float64Array(b.ito-b.ifrom),k=0,g;if(l.unrollLoops){var f=b.ito-3;for(g=b.ifrom;g<f;++g)e[k++]=this.array[g]-a.array[g],e[k++]=this.array[g+1]-a.array[g+
1],e[k++]=this.array[g+2]-a.array[g+2],e[k++]=this.array[g+3]-a.array[g+3]}else g=b.ifrom;for(;g<b.ito;++g)e[k++]=this.array[g]-a.array[g];h.MathWorker.gatherVector(e,this.length,b.ifrom,d,c)};h.Vector.prototype.workerTimes=function(a,d,c){h.util.checkVectors(this,a);h.util.checkNullOrUndefined(d);var b=h.util.loadBalance(this.length),e=new Float64Array(b.ito-b.ifrom),k=0,g;if(l.unrollLoops){var f=b.ito-3;for(g=b.ifrom;g<f;++g)e[k++]=this.array[g]*a.array[g],e[k++]=this.array[g+1]*a.array[g+1],e[k++]=
this.array[g+2]*a.array[g+2],e[k++]=this.array[g+3]*a.array[g+3]}else g=b.ifrom;for(;g<b.ito;++g)e[k++]=this.array[g]*a.array[g];h.MathWorker.gatherVector(e,this.length,b.ifrom,d,c)};h.Vector.prototype.workerDivide=function(a,d,c){h.util.checkVectors(this,a);h.util.checkNullOrUndefined(d);var b=h.util.loadBalance(this.length),e=new Float64Array(b.ito-b.ifrom),k=0,g;if(l.unrollLoops){var f=b.ito-3;for(g=b.ifrom;g<f;++g)e[k++]=this.array[g]/a.array[g],e[k++]=this.array[g+1]/a.array[g+1],e[k++]=this.array[g+
2]/a.array[g+2],e[k++]=this.array[g+3]/a.array[g+3]}else g=b.ifrom;for(;g<b.ito;++g)e[k++]=this.array[g]/a.array[g];h.MathWorker.gatherVector(e,this.length,b.ifrom,d,c)};h.Vector.prototype.workerScale=function(a,d,c){h.util.checkNumber(a);h.util.checkNullOrUndefined(d);var b=h.util.loadBalance(this.length),e=new Float64Array(b.ito-b.ifrom),k=0,g;if(l.unrollLoops){var f=b.ito-3;for(g=b.ifrom;g<f;++g)e[k++]=this.array[g]*a,e[k++]=this.array[g+1]*a,e[k++]=this.array[g+2]*a,e[k++]=this.array[g+3]*a}else g=
b.ifrom;for(;g<b.ito;++g)e[k++]=this.array[g]*a;h.MathWorker.gatherVector(e,this.length,b.ifrom,d,c)};h.Vector.prototype.workerApply=function(a,d,c){h.util.checkFunction(a);h.util.checkNullOrUndefined(d);var b=h.util.loadBalance(this.length),e=new Float64Array(b.ito-b.ifrom),k=0,g;if(l.unrollLoops){var f=b.ito-3;for(g=b.ifrom;g<f;++g)e[k++]=a(this.array[g]),e[k++]=a(this.array[g+1]),e[k++]=a(this.array[g+2]),e[k++]=a(this.array[g+3])}else g=b.ifrom;for(;g<b.ito;++g)e[k++]=a(this.array[g]);h.MathWorker.gatherVector(e,
this.length,b.ifrom,d,c)};h.Vector.prototype.workerDotVector=function(a,d,c){h.util.checkVectors(this,a);h.util.checkNullOrUndefined(d);var b=h.util.loadBalance(this.length),e,k=0;if(l.unrollLoops){var g=b.ito-3;for(e=b.ifrom;e<g;e+=4)k+=this.array[e]*a.array[e]+this.array[e+1]*a.array[e+1]+this.array[e+2]*a.array[e+2]+this.array[e+3]*a.array[e+3]}else e=b.ifrom;for(;e<b.ito;++e)k+=this.array[e]*a.array[e];h.MathWorker.reduceVectorSum(k,d,c)};h.Vector.prototype.workerDotMatrix=function(a,d,c){h.util.checkVectorMatrix(this,
a);h.util.checkNullOrUndefined(d);var b,e,k=this.length,g=h.util.loadBalance(a.ncols),f=new Float64Array(g.ito-g.ifrom),n=0;if(l.unrollLoops){var p=k-3;for(b=g.ifrom;b<g.ito;++b){for(e=m=0;e<p;e+=4)m+=this.array[e]*a.array[e][b]+this.array[e+1]*a.array[e+1][b]+this.array[e+2]*a.array[e+2][b]+this.array[e+3]*a.array[e+3][b];for(;e<k;++e)m+=this.array[e]*a.array[e][b];f[n++]=m}}else for(b=g.ifrom;b<g.ito;++b){var m=0;for(e=0;e<k;++e)m+=this.array[e]*a.array[e][b];f[n++]=m}h.MathWorker.gatherVector(f,
this.length,g.ifrom,d,c)};h.Matrix=function(a,d){this.array=[];this.nrows=a||0;this.ncols=d||0;if(0<a&&0<d){this.array=Array(a);for(var c=0;c<a;++c)this.array[c]=new Float64Array(d)}};h.Matrix.fromArray=function(a){h.util.checkArray(a);var d=new h.Matrix(a.length,a[0].length),c,b,e,k=a.length;for(c=0;c<k;++c)for(e=a[c].length,b=0;b<e;++b)d.array[c][b]=a[c][b];return d};h.Matrix.prototype.setMatrix=function(a){h.util.checkArray(a);h.util.checkFloat64Array(a[0]);this.array=a;this.nrows=a.length;this.ncols=
a[0].length};h.Matrix.prototype.copyColumn=function(a,d){for(var c=0,b=this.nrows;c<b;++c)d[c]=this.array[c][a]};h.Matrix.prototype.copyRow=function(a,d){for(var c=0,b=this.ncols;c<b;++c)d[c]=this.array[a][c]};h.Matrix.prototype.isSquare=function(){return this.nrows===this.ncols};h.Matrix.zeroes=function(a,d){for(var c=new h.Matrix(a,d),b=0;b<a;++b)for(var e=0;e<d;++e)c.array[b][e]=0;return c};h.Matrix.identity=function(a){for(var d=new h.Matrix(a,a),c=0;c<a;++c){for(var b=0;b<a;++b)d.array[c][b]=
0;d.array[c][c]=1}return d};h.Matrix.randomMatrix=function(a,d){for(var c=new h.Matrix(a,d),b=0;b<a;++b)for(var e=0;e<d;++e)c.array[b][e]=Math.random();return c};h.Matrix.prototype.toString=function(){for(var a="",d=0;d<this.nrows;++d){for(var c="[",b=0;b<this.ncols-1;++b)c+=this.array[d][b]+", ";a+=c+this.array[d][this.ncols-1]+"]";d!=this.nrows-1&&(a+="\n")}return a};h.Matrix.prototype.plus=function(a){h.util.checkMatrices(this,a);var d=new h.Matrix(this.nrows,this.ncols),c,b,e,k,g=this.nrows,f=
this.ncols;if(l.unrollLoops){var n=f-3;for(c=0;c<g;++c){e=this.array[c];k=a.array[c];for(b=0;b<n;b+=4)d.array[c][b]=e[b]+k[b],d.array[c][b+1]=e[b+1]+k[b+1],d.array[c][b+2]=e[b+2]+k[b+2],d.array[c][b+3]=e[b+3]+k[b+3];for(;b<f;++b)d.array[c][b]=e[b]+k[b]}}else for(c=0;c<g;++c)for(e=this.array[c],k=a.array[c],b=0;b<f;++b)d.array[c][b]=e[b]+k[b];return d};h.Matrix.prototype.minus=function(a){h.util.checkMatrices(this,a);var d=new h.Matrix(this.nrows,this.ncols),c,b,e,k,g=this.nrows,f=this.ncols;if(l.unrollLoops){var n=
f-3;for(c=0;c<g;++c){e=this.array[c];k=a.array[c];for(b=0;b<n;b+=4)d.array[c][b]=e[b]-k[b],d.array[c][b+1]=e[b+1]-k[b+1],d.array[c][b+2]=e[b+2]-k[b+2],d.array[c][b+3]=e[b+3]-k[b+3];for(;b<f;++b)d.array[c][b]=e[b]-k[b]}}else for(c=0;c<g;++c)for(e=this.array[c],k=a.array[c],b=0;b<f;++b)d.array[c][b]=e[b]-k[b];return d};h.Matrix.prototype.times=function(a){h.util.checkMatrices(this,a);var d=new h.Matrix(this.nrows,this.ncols),c,b,e,k,g=this.nrows,f=this.ncols;if(l.unrollLoops){var n=f-3;for(c=0;c<g;++c){e=
this.array[c];k=a.array[c];for(b=0;b<n;b+=4)d.array[c][b]=e[b]*k[b],d.array[c][b+1]=e[b+1]*k[b+1],d.array[c][b+2]=e[b+2]*k[b+2],d.array[c][b+3]=e[b+3]*k[b+3];for(;b<f;++b)d.array[c][b]=e[b]*k[b]}}else for(c=0;c<g;++c)for(e=this.array[c],k=a.array[c],b=0;b<f;++b)d.array[c][b]=e[b]*k[b];return d};h.Matrix.prototype.divide=function(a){h.util.checkMatrices(this,a);var d=new h.Matrix(this.nrows,this.ncols),c,b,e,k,g=this.nrows,f=this.ncols;if(l.unrollLoops){var n=f-3;for(c=0;c<g;++c){e=this.array[c];k=
a.array[c];for(b=0;b<n;b+=4)d.array[c][b]=e[b]/k[b],d.array[c][b+1]=e[b+1]/k[b+1],d.array[c][b+2]=e[b+2]/k[b+2],d.array[c][b+3]=e[b+3]/k[b+3];for(;b<f;++b)d.array[c][b]=e[b]/k[b]}}else for(c=0;c<g;++c)for(e=this.array[c],k=a.array[c],b=0;b<f;++b)d.array[c][b]=e[b]/k[b];return d};h.Matrix.prototype.scale=function(a){h.util.checkNumber(a);var d=new h.Matrix(this.nrows,this.ncols),c,b,e,k=this.nrows,g=this.ncols;if(l.unrollLoops){var f=g-3;for(c=0;c<k;++c){e=this.array[c];for(b=0;b<f;b+=4)d.array[c][b]=
e[b]*a,d.array[c][b+1]=e[b+1]*a,d.array[c][b+2]=e[b+2]*a,d.array[c][b+3]=e[b+3]*a;for(;b<g;++b)d.array[c][b]=e[b]*a}}else for(c=0;c<k;++c)for(e=this.array[c],b=0;b<g;++b)d.array[c][b]=e[b]*a;return d};h.Matrix.prototype.apply=function(a){h.util.checkFunction(a);var d=new h.Matrix(this.nrows,this.ncols),c,b,e,k=this.nrows,g=this.ncols;if(l.unrollLoops){var f=g-3;for(c=0;c<k;++c){e=this.array[c];for(b=0;b<f;b+=4)d.array[c][b]=a(e[b]),d.array[c][b+1]=a(e[b+1]),d.array[c][b+2]=a(e[b+2]),d.array[c][b+
3]=a(e[b+3]);for(;b<g;++b)d.array[c][b]=a(e[b])}}else for(c=0;c<k;++c)for(e=this.array[c],b=0;b<g;++b)d.array[c][b]=a(e[b]);return d};h.Matrix.prototype.transpose=function(){var a=new h.Matrix(this.ncols,this.nrows),d,c,b,e=this.nrows,k=this.ncols;for(d=0;d<e;++d)for(b=this.array[d],c=0;c<k;++c)a.array[c][d]=b[c];return a};h.Matrix.prototype.transposeInPlace=function(){if(this.isSquare()){var a,d,c=this.nrows,b=this.ncols;for(a=0;a<c;++a)for(d=a+1;d<b;++d){var e=this.array[a][d];this.array[a][d]=
this.array[d][a];this.array[d][a]=e}}else throw Error("In place transpose only available for square matrices.");return this};h.Matrix.prototype.dotVector=function(a){h.util.checkMatrixVector(this,a);var d=new h.Vector(this.nrows),c,b,e,k=this.nrows,g=this.ncols,f;if(l.unrollLoops){var n=g-3;for(b=0;b<k;++b){c=0;f=this.array[b];for(e=0;e<n;e+=4)c+=f[e]*a.array[e]+f[e+1]*a.array[e+1]+f[e+2]*a.array[e+2]+f[e+3]*a.array[e+3];for(;e<g;++e)c+=f[e]*a.array[e];d.array[b]=c}}else for(b=0;b<k;++b){c=0;f=this.array[b];
for(e=0;e<g;++e)c+=f[e]*a.array[e];d.array[b]=c}return d};h.Matrix.prototype.dotMatrix=function(a){h.util.checkMatrixMatrix(this,a);var d=new h.Matrix(this.nrows,a.ncols),c,b,e,k,g,f=this.nrows,n=this.ncols,p=a.ncols,m=new Float64Array(n);if(l.unrollLoops){var q=n-3;for(e=0;e<p;++e)for(a.copyColumn(e,m),c=0;c<f;++c){k=0;g=this.array[c];for(b=0;b<q;b+=4)k+=g[b]*m[b]+g[b+1]*m[b+1]+g[b+2]*m[b+2]+g[b+3]*m[b+3];for(;b<n;++b)k+=g[b]*m[b];d.array[c][e]=k}}else for(e=0;e<p;++e)for(a.copyColumn(e,m),c=0;c<
f;++c){k=0;g=this.array[c];for(b=0;b<n;++b)k+=g[b]*m[b];d.array[c][e]=k}return d};h.Matrix.prototype.workerPlus=function(a,d,c){h.util.checkMatrices(this,a);h.util.checkNullOrUndefined(d);var b=h.util.loadBalance(this.nrows),e=[],k=0,g,f,n,p,m,q=this.ncols;if(l.unrollLoops){var r=q-3;for(g=b.ifrom;g<b.ito;++g){e.push(new Float64Array(q));n=this.array[g];p=a.array[g];m=e[k];for(f=0;f<r;f+=4)m[f]=n[f]+p[f],m[f+1]=n[f+1]+p[f+1],m[f+2]=n[f+2]+p[f+2],m[f+3]=n[f+3]+p[f+3];for(;f<q;++f)m[f]=n[f]+p[f];++k}}else for(g=
b.ifrom;g<b.ito;++g){e.push(new Float64Array(q));n=this.array[g];p=a.array[g];m=e[k];for(f=0;f<q;++f)m[f]=n[f]+p[f];++k}h.MathWorker.gatherMatrixRows(e,this.nrows,b.ifrom,d,c)};h.Matrix.prototype.workerMinus=function(a,d,c){h.util.checkMatrices(this,a);h.util.checkNullOrUndefined(d);var b=h.util.loadBalance(this.nrows),e=[],k=0,g,f,n,p,m,q=this.ncols;if(l.unrollLoops){var r=q-3;for(g=b.ifrom;g<b.ito;++g){e.push(new Float64Array(q));n=this.array[g];p=a.array[g];m=e[k];for(f=0;f<r;f+=4)m[f]=n[f]-p[f],
m[f+1]=n[f+1]-p[f+1],m[f+2]=n[f+2]-p[f+2],m[f+3]=n[f+3]-p[f+3];for(;f<q;++f)m[f]=n[f]-p[f];++k}}else for(g=b.ifrom;g<b.ito;++g){e.push(new Float64Array(q));n=this.array[g];p=a.array[g];m=e[k];for(f=0;f<q;++f)m[f]=n[f]-p[f];++k}h.MathWorker.gatherMatrixRows(e,this.nrows,b.ifrom,d,c)};h.Matrix.prototype.workerTimes=function(a,d,c){h.util.checkMatrices(this,a);h.util.checkNullOrUndefined(d);var b=h.util.loadBalance(this.nrows),e=[],k=0,g,f,n,p,m,q=this.ncols;if(l.unrollLoops){var r=q-3;for(g=b.ifrom;g<
b.ito;++g){e.push(new Float64Array(q));n=this.array[g];p=a.array[g];m=e[k];for(f=0;f<r;f+=4)m[f]=n[f]*p[f],m[f+1]=n[f+1]*p[f+1],m[f+2]=n[f+2]*p[f+2],m[f+3]=n[f+3]*p[f+3];for(;f<q;++f)m[f]=n[f]*p[f];++k}}else for(g=b.ifrom;g<b.ito;++g){e.push(new Float64Array(q));n=this.array[g];p=a.array[g];m=e[k];for(f=0;f<q;++f)m[f]=n[f]*p[f];++k}h.MathWorker.gatherMatrixRows(e,this.nrows,b.ifrom,d,c)};h.Matrix.prototype.workerDivide=function(a,d,c){h.util.checkMatrices(this,a);h.util.checkNullOrUndefined(d);var b=
h.util.loadBalance(this.nrows),e=[],k=0,g,f,n,p,m,q=this.ncols;if(l.unrollLoops){var r=q-3;for(g=b.ifrom;g<b.ito;++g){e.push(new Float64Array(q));n=this.array[g];p=a.array[g];m=e[k];for(f=0;f<r;f+=4)m[f]=n[f]/p[f],m[f+1]=n[f+1]/p[f+1],m[f+2]=n[f+2]/p[f+2],m[f+3]=n[f+3]/p[f+3];for(;f<q;++f)m[f]=n[f]/p[f];++k}}else for(g=b.ifrom;g<b.ito;++g){e.push(new Float64Array(q));n=this.array[g];p=a.array[g];m=e[k];for(f=0;f<q;++f)m[f]=n[f]/p[f];++k}h.MathWorker.gatherMatrixRows(e,this.nrows,b.ifrom,d,c)};h.Matrix.prototype.workerScale=
function(a,d,c){h.util.checkNumber(a);h.util.checkNullOrUndefined(d);var b=h.util.loadBalance(this.nrows),e=[],k=0,g,f,n,p,m=this.ncols;if(l.unrollLoops){var q=m-3;for(g=b.ifrom;g<b.ito;++g){e.push(new Float64Array(m));n=this.array[g];p=e[k];for(f=0;f<q;f+=4)p[f]=n[f]*a,p[f+1]=n[f+1]*a,p[f+2]=n[f+2]*a,p[f+3]=n[f+3]*a;for(;f<m;++f)p[f]=n[f]*a;++k}}else for(g=b.ifrom;g<b.ito;++g){e.push(new Float64Array(m));n=this.array[g];p=e[k];for(f=0;f<m;++f)p[f]=n[f]*a;++k}h.MathWorker.gatherMatrixRows(e,this.nrows,
b.ifrom,d,c)};h.Matrix.prototype.workerApply=function(a,d,c){h.util.checkFunction(a);h.util.checkNullOrUndefined(d);var b=h.util.loadBalance(this.nrows),e=[],k=0,g,f,n,p,m=this.ncols;if(l.unrollLoops){var q=m-3;for(g=b.ifrom;g<b.ito;++g){e.push(new Float64Array(m));n=this.array[g];p=e[k];for(f=0;f<q;f+=4)p[f]=a(n[f]),p[f+1]=a(n[f+1]),p[f+2]=a(n[f+2]),p[f+3]=a(n[f+3]);for(;f<m;++f)p[f]=a(n[f]);++k}}else for(g=b.ifrom;g<b.ito;++g){e.push(new Float64Array(m));n=this.array[g];p=e[k];for(f=0;f<m;++f)p[f]=
a(n[f]);++k}h.MathWorker.gatherMatrixRows(e,this.nrows,b.ifrom,d,c)};h.Matrix.prototype.workerDotVector=function(a,d,c){h.util.checkMatrixVector(this,a);h.util.checkNullOrUndefined(d);var b=h.util.loadBalance(this.nrows),e=new Float64Array(b.ito-b.ifrom),k,g,f,n,p=this.ncols,m=0;if(l.unrollLoops){var q=p-3;for(k=b.ifrom;k<b.ito;++k){n=this.array[k];for(g=f=0;g<q;g+=4)f+=n[g]*a.array[g]+n[g+1]*a.array[g+1]+n[g+2]*a.array[g+2]+n[g+3]*a.array[g+3];for(;g<p;++g)f+=n[g]*a.array[g];e[m++]=f}}else for(k=
b.ifrom;k<b.ito;++k){n=this.array[k];for(g=f=0;g<p;++g)f+=n[g]*a.array[g];e[m++]=f}h.MathWorker.gatherVector(e,a.length,b.ifrom,d,c)};h.Matrix.prototype.workerDotMatrix=function(a,d,c){h.util.checkMatrixMatrix(this,a);h.util.checkNullOrUndefined(d);var b,e,k,g,f,n=this.nrows,p=this.ncols,m=h.util.loadBalance(a.ncols),q=m.ito-m.ifrom,r=Array(q);for(k=0;k<q;++k)r[k]=new Float64Array(n);var t=new Float64Array(p);if(l.unrollLoops){var w=p-3;for(k=0;k<q;++k)for(a.copyColumn(m.ifrom+k,t),b=0;b<n;++b){g=
0;f=this.array[b];for(e=0;e<w;e+=4)g+=f[e]*t[e]+f[e+1]*t[e+1]+f[e+2]*t[e+2]+f[e+3]*t[e+3];for(;e<p;++e)g+=f[e]*t[e];r[k][b]=g}}else for(k=0;k<q;++k)for(a.copyColumn(m.ifrom+k,t),b=0;b<n;++b){g=0;f=this.array[b];for(e=0;e<p;++e)g+=f[e]*t[e];r[k][b]=g}h.MathWorker.gatherMatrixColumns(r,this.nrows,a.ncols,m.ifrom,d,c)};h.Batch={};h.Batch.workerVectorLinearCombination=function(a,d,c,b){h.util.checkNumber(d[0]);h.util.checkVector(a[0]);h.util.checkNullOrUndefined(c);var e,k,g,f=0,n=a[0],p=d[0],m=h.util.loadBalance(n.length),
q=new Float64Array(m.ito-m.ifrom);if(l.unrollLoops)for(g=m.ito-3,e=m.ifrom;e<g;++e)q[f++]=p*n.array[e],q[f++]=p*n.array[e+1],q[f++]=p*n.array[e+2],q[f++]=p*n.array[e+3];else e=m.ifrom;for(;e<m.ito;++e)q[f++]=p*n.array[e];for(k=1;k<a.length;++k){f=0;n=a[k];p=d[k];h.util.checkNumber(p);h.util.checkVectors(a[k-1],n);if(l.unrollLoops)for(e=m.ifrom;e<g;++e)q[f++]+=p*n.array[e],q[f++]+=p*n.array[e+1],q[f++]+=p*n.array[e+2],q[f++]+=p*n.array[e+3];else e=m.ifrom;for(;e<m.ito;++e)q[f++]+=p*n.array[e]}h.MathWorker.gatherVector(q,
n.length,m.ifrom,c,b)};h.Batch.workerMatrixLinearCombination=function(a,d,c,b){h.util.checkNumber(d[0]);h.util.checkMatrix(a[0]);h.util.checkNullOrUndefined(c);for(var e=[],k=0,g=a[0],f=d[0],n=h.util.loadBalance(a[0].nrows),l=n.ifrom;l<n.ito;++l){e.push(new Float64Array(g.ncols));for(var m=0;m<g.ncols;++m)e[k][m]=f*g.array[l][m];++k}for(var q=1;q<a.length;++q)for(k=0,g=a[q],f=d[q],h.util.checkNumber(f),h.util.checkMatrices(a[q-1],g),l=n.ifrom;l<n.ito;++l){for(m=0;m<g.ncols;++m)e[k][m]+=f*g.array[l][m];
++k}h.MathWorker.gatherMatrixRows(e,g.nrows,n.ifrom,c,b)};h.Batch.workerMatrixVectorPlus=function(a,d,c,b,e,k,g){h.util.checkNumber(a);h.util.checkMatrixVector(d,c);h.util.checkNullOrUndefined(b);var f=h.util.loadBalance(d.nrows),l=new Float64Array(f.ito-f.ifrom),p=0;if(k&&g){h.util.checkNumber(k);h.util.checkVectors(c,g);for(var m=f.ifrom;m<f.ito;++m){for(var q=0,r=0;r<this.ncols;++r)q+=d.array[m][r]*v.array[r];l[p++]=a*q+k*g[m]}}else for(m=f.ifrom;m<f.ito;++m){for(r=q=0;r<this.ncols;++r)q+=d.array[m][r]*
v.array[r];l[p++]=a*q}h.MathWorker.gatherVector(l,c.length,f.ifrom,b,e)};h.Batch.workerMatrixMatrixPlus=function(a,d,c,b,e,k,g){h.util.checkNumber(a);h.util.checkMatrixMatrix(d,c);h.util.checkNullOrUndefined(b);var f=c.isSquare()?c.transposeInPlace():c.transpose(),l=h.util.loadBalance(d.nrows),p=[],m=0;if(k&&g){h.util.checkNumber(k);h.util.checkMatrix(g);if(d.nrows!==g.nrows||c.ncols!==g.ncols)throw Error("Matrix dimensions not compatible for addition.");for(var q=l.ifrom;q<l.ito;++q){p.push(new Float64Array(c.ncols));
for(var r=0;r<c.ncols;++r){for(var t=0,w=0;w<d.ncols;++w)t+=d.array[q][w]*f.array[r][w];p[m][r]=a*t+k*g.array[q][r]}++m}}else for(q=l.ifrom;q<l.ito;++q){p.push(new Float64Array(c.ncols));for(r=0;r<c.ncols;++r){for(w=t=0;w<d.ncols;++w)t+=d.array[q][w]*f.array[r][w];p[m][r]=a*t}++m}c.isSquare&&c.transposeInPlace();h.MathWorker.gatherMatrixRows(p,d.nrows,l.ifrom,b,e)};h.Stats={};h.Stats.summary=function(a){function d(a,c){var d=c-a+1,e=d/2|0,d=d%2;return{median:d?b[a+e]:.5*(b[a+e-1]+b[a+e]),half:e,odd:d}}
h.util.checkNullOrUndefined(a);var c,b=[];if(a instanceof h.Vector)for(c=0;c<a.array.length;++c)b.push(a.array[c]);else if(a instanceof h.Matrix)for(c=0;c<a.nrows;++c)for(var e=0;e<a.ncols;++e)b.push(a.array[c][e]);else if(a instanceof Array||a instanceof Float64Array)for(c=0;c<a.length;++c)b.push(a[c]);else throw new TypeError("Invalid data type for summary(). Must be Array, Float64Array, or Vector.");var k,g=b.length,f=0;a=Math.max.apply(Math,b);e=Math.min.apply(Math,b);for(c=0;c<g;++c)f+=b[c];
var f=f/g,l=0;for(c=0;c<g;++c)k=f-b[c],l+=k*k;l/=g;c=Math.sqrt(l);var p,m,q;3<=g&&(b.sort(function(a,b){return a-b}),p=d(0,g-1),m=p.median,g=d(p.half,g-1),q=g.median,g=p.odd?d(0,p.half):d(0,p.half-1),p=g.median);return{n:b.length,mean:f,variance:l,stddev:c,minimum:e,maximum:a,quartile25:p,quartile50:m,quartile75:q}};return h}();"undefined"!==typeof module&&"undefined"!==typeof module.exports?module.exports=x:"undefined"!==typeof window?window.MathWorkers=x:self.MathWorkers=x})();
