/*
  MathWorkersJS
  @version 1.0.0
  @author Adrian W. Lange
*/
var MathWorkers=function(){function u(){var b={};this.on=function(d,c){h.util.checkFunction(c);b[d]=[c]};this.emit=function(d,c){b[d]=b[d]||[];c=c||[];b[d].forEach(function(a){a.call(this,c)})}}var h={Global:{}},m={version:"1.0.0"};h.Global.getVersion=function(){return m.version};m.workerPool=[];m.nWorkers=1;m.myWorkerId=0;m.logLevel=1;h.Global.setLogLevel=function(b){h.util.nullOrUndefined(b)||(m.logLevel=b)};m.unrollLoops=!1;h.setUnrollLoops=function(b){h.util.checkNullOrUndefined(b);m.unrollLoops=
b};m.createPool=function(b,d){h.util.checkWebWorkerSupport();for(var c=0;c<b;++c){var a=new Worker(d);a.postMessage({handle:"_init",id:c,nWorkers:b,logLevel:m.logLevel,unrollLoops:m.unrollLoops});this.workerPool.push(a);this.nWorkers=this.workerPool.length}this.getWorker=function(a){return this.workerPool[a]}};h.util={};h.util.checkWebWorkerSupport=function(){if("undefined"===typeof Worker)throw Error("Web Worker support not available for MathWorkers.");};h.util.loadBalance=function(b){var d=m.myWorkerId,
c=b/m.nWorkers|0;b%=m.nWorkers;d<b?(d*=c+1,c=d+c+1):(d=d*c+b,c=d+c);return{ifrom:d,ito:c}};h.util.nullOrUndefined=function(b){return void 0===b||null===b};h.util.checkNullOrUndefined=function(b){if(h.util.nullOrUndefined(b))throw new TypeError("Undefined or null variable.");};h.util.checkNumber=function(b){h.util.checkNullOrUndefined(b);if("number"!=typeof b)throw new TypeError("Expected type Number but is type "+typeof b);};h.util.checkFunction=function(b){h.util.checkNullOrUndefined(b);if("function"!=
typeof b)throw new TypeError("Expected type Function but is type "+typeof b);};h.util.checkArray=function(b){h.util.checkNullOrUndefined(b);if(!(b instanceof Array||b instanceof Float64Array))throw new TypeError("Expected type Array but is type "+typeof b);};h.util.checkFloat64Array=function(b){h.util.checkNullOrUndefined(b);if(!(b instanceof Float64Array))throw new TypeError("Expected type Float64Array but is type "+typeof b);};h.util.checkVector=function(b){h.util.checkNullOrUndefined(b);if(!(b instanceof
h.Vector))throw new TypeError("Expected type Vector but is not.");};h.util.checkVectors=function(b,d){h.util.checkVector(b);h.util.checkVector(d);if(b.length!==d.length)throw Error("Vectors have unequal lengths.");};h.util.checkVectorMatrix=function(b,d){h.util.checkVector(b);h.util.checkMatrix(d);if(b.length!==d.nrows)throw Error("Vector length and number Matrix rows are unequal.");};h.util.checkMatrix=function(b){h.util.checkNullOrUndefined(b);if(!(b instanceof h.Matrix))throw new TypeError("Expected type Matrix but is not.");
};h.util.checkMatrices=function(b,d){h.util.checkMatrix(b);h.util.checkMatrix(d);if(b.nrows!==d.nrows||b.ncols!==d.ncols)throw Error("Matrices do not have equal numbers of rows and columns.");};h.util.checkMatrixVector=function(b,d){h.util.checkMatrix(b);h.util.checkVector(d);if(d.length!==b.ncols)throw Error("Vector length and number Matrix columns are unequal.");};h.util.checkMatrixMatrix=function(b,d){h.util.checkMatrix(b);h.util.checkMatrix(d);if(b.ncols!==d.nrows)throw Error("Matrices do not have compatible dimensions for matrix-matrix multiplication.");
};h.Coordinator=function(b,d){var c=this,a={},e=[];this.ready=!1;m.createPool(b,d);this.onReady=function(a){c.on("_ready",a)};this.getBuffer=function(){return a};this.getMessageDataList=function(){return e};this.trigger=function(a,c){for(var b=0;b<m.nWorkers;++b)m.getWorker(b).postMessage({handle:"_trigger",tag:a,args:c})};this.sendDataToWorkers=function(a,c){for(var b=0;b<m.nWorkers;++b)m.getWorker(b).postMessage({handle:"_broadcastData",tag:c,data:a})};this.sendVectorToWorkers=function(a,c){for(var b=
0;b<m.nWorkers;++b){var e=new Float64Array(a.array);m.getWorker(b).postMessage({handle:"_broadcastVector",tag:c,vec:e.buffer},[e.buffer])}};this.sendMatrixToWorkers=function(a,c){for(var b=0;b<m.nWorkers;++b){for(var e={handle:"_broadcastMatrix",tag:c,nrows:a.nrows},d=[],f=0;f<a.nrows;++f){var g=new Float64Array(a.array[f]);e[f]=g.buffer;d.push(g.buffer)}m.getWorker(b).postMessage(e,d)}};for(var k=function(b){b=b.data;switch(b.handle){case "_workerReady":f+=1;f==m.nWorkers&&(c.ready=!0,c.emit("_ready"),
f=0);break;case "_sendData":e[b.id]=b.data;f+=1;f==m.nWorkers&&(c.emit(b.tag),f=0);break;case "_vectorSendToCoordinator":a=new h.Vector;a.setVector(new Float64Array(b.vectorBuffer));c.emit(b.tag);break;case "_gatherVector":0==f&&(a=new h.Vector(b.len));for(var d=new Float64Array(b.vectorPart),g=b.offset,k=0;k<d.length;++k)a.array[g+k]=d[k];f+=1;f==m.nWorkers&&(b.rebroadcast?c.sendVectorToWorkers(a,b.tag):c.emit(b.tag),f=0);break;case "_matrixSendToCoordinator":d=[];for(g=0;g<b.nrows;++g)d.push(new Float64Array(b[g]));
a=new h.Matrix;a.setMatrix(d);c.emit(b.tag);break;case "_gatherMatrixRows":d=b.offset;0==f&&(a=new h.Matrix(b.nrows,b.ncols));for(g=0;g<b.nrowsPart;++g)a.array[d+g]=new Float64Array(b[g]);f+=1;f==m.nWorkers&&(b.rebroadcast?c.sendMatrixToWorkers(a,b.tag):c.emit(b.tag),f=0);break;case "_gatherMatrixColumns":0==f&&(a=new h.Matrix(b.nrows,b.ncols));var r,g=0;for(r=b.offset;g<b.nrowsPart;++g,++r)for(k=new Float64Array(b[g]),d=0;d<k.length;++d)a.array[d][r]=k[d];f+=1;f==m.nWorkers&&(b.rebroadcast?c.sendMatrixToWorkers(a,
b.tag):c.emit(b.tag),f=0);break;case "_vectorSum":a=0==f?b.tot:a+b.tot;f+=1;f==m.nWorkers&&(b.rebroadcast?c.sendDataToWorkers(a,b.tag):c.emit(b.tag),f=0);break;case "_vectorProduct":a=0==f?b.tot:a*b.tot;f+=1;f==m.nWorkers&&(b.rebroadcast?c.sendDataToWorkers(a,b.tag):c.emit(b.tag),f=0);break;default:console.error("Invalid Coordinator handle: "+b.handle)}},g=0;g<m.nWorkers;++g)m.getWorker(g).onmessage=k,e.push({});var f=0};h.Coordinator.prototype=new u;h.MathWorker=function(){var b={},d={};this.getId=
function(){return m.myWorkerId};this.getNumWorkers=function(){return m.nWorkers};this.getBuffer=function(){return b};this.on=function(a,b){2<m.logLevel&&console.log("registering trigger: "+a);d[a]=[b]};this.sendDataToCoordinator=function(a,b){self.postMessage({handle:"_sendData",id:m.myWorkerId,tag:b,data:a})};this.sendVectorToCoordinator=function(a,b){0==m.myWorkerId&&self.postMessage({handle:"_vectorSendToCoordinator",tag:b,vectorBuffer:a.array.buffer},[a.array.buffer])};this.sendMatrixToCoordinator=
function(a,b){if(0==id){for(var c={handle:"_matrixSendToCoordinator",tag:b,nrows:a.nrows},d=[],f=0;f<a.nrows;++f)c[f]=a.array[f].buffer,d.push(a.array[f].buffer);self.postMessage(c,d)}};self.onmessage=function(a){a=a.data;switch(a.handle){case "_init":m.myWorkerId=a.id;m.nWorkers=a.nWorkers;m.unrollLoops=a.unrollLoops;m.logLevel=a.logLevel;2<m.logLevel&&console.log("Initialized MathWorker: "+m.myWorkerId+" of "+m.nWorkers+" workers.");self.postMessage({handle:"_workerReady"});break;case "_trigger":c(a);
break;case "_broadcastData":b=a.data;c(a);break;case "_broadcastVector":b=h.Vector.fromArray(new Float64Array(a.vec));c(a,b);break;case "_broadcastMatrix":for(var d=[],k=0;k<a.nrows;++k)d.push(new Float64Array(a[k]));b=new h.Matrix;b.setMatrix(d);c(a,b);break;default:console.error("Invalid MathWorker handle: "+a.handle)}};var c=function(a,b){if(d[a.tag]){d[a.tag]=d[a.tag]||[];var c=a.data||b||[];d[a.tag].forEach(function(a){a.call(this,c)})}else console.error("Unregistered trigger tag: "+a.tag)}};
h.MathWorker.prototype=new u;h.MathWorker.gatherVector=function(b,d,c,a,e){self.postMessage({handle:"_gatherVector",tag:a,id:m.myWorkerId,rebroadcast:e||!1,len:d,offset:c,vectorPart:b.buffer},[b.buffer])};h.MathWorker.gatherMatrixRows=function(b,d,c,a,e){d={handle:"_gatherMatrixRows",tag:a,id:m.myWorkerId,rebroadcast:e||!1,nrows:d,ncols:b[0].length,nrowsPart:b.length,offset:c};c=[];for(a=0;a<b.length;++a)d[a]=b[a].buffer,c.push(b[a].buffer);self.postMessage(d,c)};h.MathWorker.gatherMatrixColumns=
function(b,d,c,a,e,h){d={handle:"_gatherMatrixColumns",tag:e,id:m.myWorkerId,rebroadcast:h||!1,nrows:d,ncols:c,nrowsPart:b.length,offset:a};c=[];for(a=0;a<b.length;++a)d[a]=b[a].buffer,c.push(b[a].buffer);self.postMessage(d,c)};h.MathWorker.reduceVectorSum=function(b,d,c){self.postMessage({handle:"_vectorSum",tag:d,rebroadcast:c||!1,tot:b})};h.MathWorker.reduceVectorProduct=function(b,d,c){self.postMessage({handle:"_vectorProduct",tag:d,rebroadcast:c||!1,tot:b})};h.Vector=function(b){this.array=null;
this.length=b||0;0<b&&(this.array=new Float64Array(b))};h.Vector.fromArray=function(b){h.util.checkArray(b);for(var d=new h.Vector(b.length),c=0,a=b.length;c<a;++c)d.array[c]=b[c];return d};h.Vector.prototype.setVector=function(b){h.util.checkFloat64Array(b);this.array=b;this.length=b.length};h.Vector.zeroes=function(b){for(var d=new h.Vector(b),c=0;c<b;++c)d.array[c]=0;return d};h.Vector.randomVector=function(b){for(var d=new h.Vector(b),c=0;c<b;++c)d.array[c]=Math.random();return d};h.Vector.prototype.toString=
function(){for(var b="[",d=0;d<this.length-1;++d)b+=this.array[d]+", ";return b+this.array[this.length-1]+"]"};h.Vector.prototype.sum=function(){var b=0,d,c=this.length;if(m.unrollLoops){var a=c-3;for(d=0;d<a;d+=4)b+=this.array[d]+this.array[d+1]+this.array[d+2]+this.array[d+3]}else d=0;for(;d<c;++d)b+=this.array[d];return b};h.Vector.prototype.product=function(){var b=1,d,c=this.length;if(m.unrollLoops){var a=c-3;for(d=0;d<a;d+=4)b=b*this.array[d]*this.array[d+1]*this.array[d+2]*this.array[d+3]}else d=
0;for(;d<c;++d)b*=this.array[d];return b};h.Vector.prototype.plus=function(b){h.util.checkVectors(this,b);var d=new h.Vector(this.length),c,a=this.length;if(m.unrollLoops){var e=a-3;for(c=0;c<e;c+=4)d.array[c]=this.array[c]+b.array[c],d.array[c+1]=this.array[c+1]+b.array[c+1],d.array[c+2]=this.array[c+2]+b.array[c+2],d.array[c+3]=this.array[c+3]+b.array[c+3]}else c=0;for(;c<a;++c)d.array[c]=this.array[c]+b.array[c];return d};h.Vector.prototype.minus=function(b){h.util.checkVectors(this,b);var d=new h.Vector(this.length),
c,a=this.length;if(m.unrollLoops){var e=a-3;for(c=0;c<e;c+=4)d.array[c]=this.array[c]-b.array[c],d.array[c+1]=this.array[c+1]-b.array[c+1],d.array[c+2]=this.array[c+2]-b.array[c+2],d.array[c+3]=this.array[c+3]-b.array[c+3]}else c=0;for(;c<a;++c)d.array[c]=this.array[c]-b.array[c];return d};h.Vector.prototype.times=function(b){h.util.checkVectors(this,b);var d=new h.Vector(this.length),c,a=this.length;if(m.unrollLoops){var e=a-3;for(c=0;c<e;c+=4)d.array[c]=this.array[c]*b.array[c],d.array[c+1]=this.array[c+
1]*b.array[c+1],d.array[c+2]=this.array[c+2]*b.array[c+2],d.array[c+3]=this.array[c+3]*b.array[c+3]}else c=0;for(;c<a;++c)d.array[c]=this.array[c]*b.array[c];return d};h.Vector.prototype.divide=function(b){h.util.checkVectors(this,b);var d=new h.Vector(this.length),c,a=this.length;if(m.unrollLoops){var e=a-3;for(c=0;c<e;c+=4)d.array[c]=this.array[c]/b.array[c],d.array[c+1]=this.array[c+1]/b.array[c+1],d.array[c+2]=this.array[c+2]/b.array[c+2],d.array[c+3]=this.array[c+3]/b.array[c+3]}else c=0;for(;c<
a;++c)d.array[c]=this.array[c]/b.array[c];return d};h.Vector.prototype.scale=function(b){h.util.checkNumber(b);var d=new h.Vector(this.length),c,a=this.length;if(m.unrollLoops){var e=a-3;for(c=0;c<e;c+=4)d.array[c]=this.array[c]*b,d.array[c+1]=this.array[c+1]*b,d.array[c+2]=this.array[c+2]*b,d.array[c+3]=this.array[c+3]*b}else c=0;for(;c<a;++c)d.array[c]=this.array[c]*b;return d};h.Vector.prototype.apply=function(b){h.util.checkFunction(b);var d=new h.Vector(this.length),c,a=this.length;if(m.unrollLoops){var e=
a-3;for(c=0;c<e;c+=4)d.array[c]=b(this.array[c]),d.array[c+1]=b(this.array[c+1]),d.array[c+2]=b(this.array[c+2]),d.array[c+3]=b(this.array[c+3])}else c=0;for(;c<a;++c)d.array[c]=b(this.array[c]);return d};h.Vector.prototype.dotVector=function(b){h.util.checkVectors(this,b);var d,c=this.length,a=0;if(m.unrollLoops){var e=c-3;for(d=0;d<e;d+=4)a+=this.array[d]*b.array[d]+this.array[d+1]*b.array[d+1]+this.array[d+2]*b.array[d+2]+this.array[d+3]*b.array[d+3]}else d=0;for(;d<c;++d)a+=this.array[d]*b.array[d];
return a};h.Vector.prototype.dotMatrix=function(b){h.util.checkVectorMatrix(this,b);var d,c,a,e=b.ncols,k=this.length,g=new h.Vector(e);if(m.unrollLoops){var f=k-3;for(d=0;d<e;++d){for(c=a=0;c<f;c+=4)a+=this.array[c]*b.array[c][d]+this.array[c+1]*b.array[c+1][d]+this.array[c+2]*b.array[c+2][d]+this.array[c+3]*b.array[c+3][d];for(;c<k;++c)a+=this.array[c]*b.array[c][d];g.array[d]=a}}else for(d=0;d<e;++d){for(c=a=0;c<k;++c)a+=this.array[c]*b.array[c][d];g.array[d]=a}return g};h.Vector.prototype.workerSum=
function(b,d){h.util.checkNullOrUndefined(b);var c=h.util.loadBalance(this.length),a=0,e;if(m.unrollLoops){var k=c.ito-3;for(e=c.ifrom;e<k;++e)a+=this.array[e]+this.array[e+1]+this.array[e+2]+this.array[e+3]}else e=c.ifrom;for(;e<c.ito;++e)a+=this.array[e];h.MathWorker.reduceVectorSum(a,b,d)};h.Vector.prototype.workerProduct=function(b,d){h.util.checkNullOrUndefined(b);var c=h.util.loadBalance(this.length),a=1,e;if(m.unrollLoops){var k=c.ito-3;for(e=c.ifrom;e<k;++e)a=a*this.array[e]*this.array[e+
1]*this.array[e+2]*this.array[e+3]}else e=c.ifrom;for(;e<c.ito;++e)a*=this.array[e];h.MathWorker.reduceVectorProduct(a,b,d)};h.Vector.prototype.workerPlus=function(b,d,c){h.util.checkVectors(this,b);h.util.checkNullOrUndefined(d);var a=h.util.loadBalance(this.length),e=new Float64Array(a.ito-a.ifrom),k=0,g;if(m.unrollLoops){var f=a.ito-3;for(g=a.ifrom;g<f;++g)e[k++]=this.array[g]+b.array[g],e[k++]=this.array[g+1]+b.array[g+1],e[k++]=this.array[g+2]+b.array[g+2],e[k++]=this.array[g+3]+b.array[g+3]}else g=
a.ifrom;for(;g<a.ito;++g)e[k++]=this.array[g]+b.array[g];h.MathWorker.gatherVector(e,this.length,a.ifrom,d,c)};h.Vector.prototype.workerMinus=function(b,d,c){h.util.checkVectors(this,b);h.util.checkNullOrUndefined(d);var a=h.util.loadBalance(this.length),e=new Float64Array(a.ito-a.ifrom),k=0,g;if(m.unrollLoops){var f=a.ito-3;for(g=a.ifrom;g<f;++g)e[k++]=this.array[g]-b.array[g],e[k++]=this.array[g+1]-b.array[g+1],e[k++]=this.array[g+2]-b.array[g+2],e[k++]=this.array[g+3]-b.array[g+3]}else g=a.ifrom;
for(;g<a.ito;++g)e[k++]=this.array[g]-b.array[g];h.MathWorker.gatherVector(e,this.length,a.ifrom,d,c)};h.Vector.prototype.workerTimes=function(b,d,c){h.util.checkVectors(this,b);h.util.checkNullOrUndefined(d);var a=h.util.loadBalance(this.length),e=new Float64Array(a.ito-a.ifrom),k=0,g;if(m.unrollLoops){var f=a.ito-3;for(g=a.ifrom;g<f;++g)e[k++]=this.array[g]*b.array[g],e[k++]=this.array[g+1]*b.array[g+1],e[k++]=this.array[g+2]*b.array[g+2],e[k++]=this.array[g+3]*b.array[g+3]}else g=a.ifrom;for(;g<
a.ito;++g)e[k++]=this.array[g]*b.array[g];h.MathWorker.gatherVector(e,this.length,a.ifrom,d,c)};h.Vector.prototype.workerDivide=function(b,d,c){h.util.checkVectors(this,b);h.util.checkNullOrUndefined(d);var a=h.util.loadBalance(this.length),e=new Float64Array(a.ito-a.ifrom),k=0,g;if(m.unrollLoops){var f=a.ito-3;for(g=a.ifrom;g<f;++g)e[k++]=this.array[g]/b.array[g],e[k++]=this.array[g+1]/b.array[g+1],e[k++]=this.array[g+2]/b.array[g+2],e[k++]=this.array[g+3]/b.array[g+3]}else g=a.ifrom;for(;g<a.ito;++g)e[k++]=
this.array[g]/b.array[g];h.MathWorker.gatherVector(e,this.length,a.ifrom,d,c)};h.Vector.prototype.workerScale=function(b,d,c){h.util.checkNumber(b);h.util.checkNullOrUndefined(d);var a=h.util.loadBalance(this.length),e=new Float64Array(a.ito-a.ifrom),k=0,g;if(m.unrollLoops){var f=a.ito-3;for(g=a.ifrom;g<f;++g)e[k++]=this.array[g]*b,e[k++]=this.array[g+1]*b,e[k++]=this.array[g+2]*b,e[k++]=this.array[g+3]*b}else g=a.ifrom;for(;g<a.ito;++g)e[k++]=this.array[g]*b;h.MathWorker.gatherVector(e,this.length,
a.ifrom,d,c)};h.Vector.prototype.workerApply=function(b,d,c){h.util.checkFunction(b);h.util.checkNullOrUndefined(d);var a=h.util.loadBalance(this.length),e=new Float64Array(a.ito-a.ifrom),k=0,g;if(m.unrollLoops){var f=a.ito-3;for(g=a.ifrom;g<f;++g)e[k++]=b(this.array[g]),e[k++]=b(this.array[g+1]),e[k++]=b(this.array[g+2]),e[k++]=b(this.array[g+3])}else g=a.ifrom;for(;g<a.ito;++g)e[k++]=b(this.array[g]);h.MathWorker.gatherVector(e,this.length,a.ifrom,d,c)};h.Vector.prototype.workerDotVector=function(b,
d,c){h.util.checkVectors(this,b);h.util.checkNullOrUndefined(d);var a=h.util.loadBalance(this.length),e,k=0;if(m.unrollLoops){var g=a.ito-3;for(e=a.ifrom;e<g;e+=4)k+=this.array[e]*b.array[e]+this.array[e+1]*b.array[e+1]+this.array[e+2]*b.array[e+2]+this.array[e+3]*b.array[e+3]}else e=a.ifrom;for(;e<a.ito;++e)k+=this.array[e]*b.array[e];h.MathWorker.reduceVectorSum(k,d,c)};h.Vector.prototype.workerDotMatrix=function(b,d,c){h.util.checkVectorMatrix(this,b);h.util.checkNullOrUndefined(d);var a,e,k=this.length,
g=h.util.loadBalance(b.ncols),f=new Float64Array(g.ito-g.ifrom),l=0;if(m.unrollLoops){var p=k-3;for(a=g.ifrom;a<g.ito;++a){for(e=n=0;e<p;e+=4)n+=this.array[e]*b.array[e][a]+this.array[e+1]*b.array[e+1][a]+this.array[e+2]*b.array[e+2][a]+this.array[e+3]*b.array[e+3][a];for(;e<k;++e)n+=this.array[e]*b.array[e][a];f[l++]=n}}else for(a=g.ifrom;a<g.ito;++a){var n=0;for(e=0;e<k;++e)n+=this.array[e]*b.array[e][a];f[l++]=n}h.MathWorker.gatherVector(f,this.length,g.ifrom,d,c)};h.Matrix=function(b,d){this.array=
[];this.nrows=b||0;this.ncols=d||0;if(0<b&&0<d){this.array=Array(b);for(var c=0;c<b;++c)this.array[c]=new Float64Array(d)}};h.Matrix.fromArray=function(b){h.util.checkArray(b);var d=new h.Matrix(b.length,b[0].length),c,a,e,k=b.length;for(c=0;c<k;++c)for(e=b[c].length,a=0;a<e;++a)d.array[c][a]=b[c][a];return d};h.Matrix.prototype.setMatrix=function(b){h.util.checkArray(b);h.util.checkFloat64Array(b[0]);this.array=b;this.nrows=b.length;this.ncols=b[0].length};h.Matrix.prototype.copyColumn=function(b,
d){for(var c=0,a=this.nrows;c<a;++c)d[c]=this.array[c][b]};h.Matrix.prototype.copyRow=function(b,d){for(var c=0,a=this.ncols;c<a;++c)d[c]=this.array[b][c]};h.Matrix.prototype.isSquare=function(){return this.nrows===this.ncols};h.Matrix.zeroes=function(b,d){for(var c=new h.Matrix(b,d),a=0;a<b;++a)for(var e=0;e<d;++e)c.array[a][e]=0;return c};h.Matrix.identity=function(b){for(var d=new h.Matrix(b,b),c=0;c<b;++c){for(var a=0;a<b;++a)d.array[c][a]=0;d.array[c][c]=1}return d};h.Matrix.randomMatrix=function(b,
d){for(var c=new h.Matrix(b,d),a=0;a<b;++a)for(var e=0;e<d;++e)c.array[a][e]=Math.random();return c};h.Matrix.prototype.toString=function(){for(var b="",d=0;d<this.nrows;++d){for(var c="[",a=0;a<this.ncols-1;++a)c+=this.array[d][a]+", ";b+=c+this.array[d][this.ncols-1]+"]";d!=this.nrows-1&&(b+="\n")}return b};h.Matrix.prototype.plus=function(b){h.util.checkMatrices(this,b);var d=new h.Matrix(this.nrows,this.ncols),c,a,e,k,g=this.nrows,f=this.ncols;if(m.unrollLoops){var l=f-3;for(c=0;c<g;++c){e=this.array[c];
k=b.array[c];for(a=0;a<l;a+=4)d.array[c][a]=e[a]+k[a],d.array[c][a+1]=e[a+1]+k[a+1],d.array[c][a+2]=e[a+2]+k[a+2],d.array[c][a+3]=e[a+3]+k[a+3];for(;a<f;++a)d.array[c][a]=e[a]+k[a]}}else for(c=0;c<g;++c)for(e=this.array[c],k=b.array[c],a=0;a<f;++a)d.array[c][a]=e[a]+k[a];return d};h.Matrix.prototype.minus=function(b){h.util.checkMatrices(this,b);var d=new h.Matrix(this.nrows,this.ncols),c,a,e,k,g=this.nrows,f=this.ncols;if(m.unrollLoops){var l=f-3;for(c=0;c<g;++c){e=this.array[c];k=b.array[c];for(a=
0;a<l;a+=4)d.array[c][a]=e[a]-k[a],d.array[c][a+1]=e[a+1]-k[a+1],d.array[c][a+2]=e[a+2]-k[a+2],d.array[c][a+3]=e[a+3]-k[a+3];for(;a<f;++a)d.array[c][a]=e[a]-k[a]}}else for(c=0;c<g;++c)for(e=this.array[c],k=b.array[c],a=0;a<f;++a)d.array[c][a]=e[a]-k[a];return d};h.Matrix.prototype.times=function(b){h.util.checkMatrices(this,b);var d=new h.Matrix(this.nrows,this.ncols),c,a,e,k,g=this.nrows,f=this.ncols;if(m.unrollLoops){var l=f-3;for(c=0;c<g;++c){e=this.array[c];k=b.array[c];for(a=0;a<l;a+=4)d.array[c][a]=
e[a]*k[a],d.array[c][a+1]=e[a+1]*k[a+1],d.array[c][a+2]=e[a+2]*k[a+2],d.array[c][a+3]=e[a+3]*k[a+3];for(;a<f;++a)d.array[c][a]=e[a]*k[a]}}else for(c=0;c<g;++c)for(e=this.array[c],k=b.array[c],a=0;a<f;++a)d.array[c][a]=e[a]*k[a];return d};h.Matrix.prototype.divide=function(b){h.util.checkMatrices(this,b);var d=new h.Matrix(this.nrows,this.ncols),c,a,e,k,g=this.nrows,f=this.ncols;if(m.unrollLoops){var l=f-3;for(c=0;c<g;++c){e=this.array[c];k=b.array[c];for(a=0;a<l;a+=4)d.array[c][a]=e[a]/k[a],d.array[c][a+
1]=e[a+1]/k[a+1],d.array[c][a+2]=e[a+2]/k[a+2],d.array[c][a+3]=e[a+3]/k[a+3];for(;a<f;++a)d.array[c][a]=e[a]/k[a]}}else for(c=0;c<g;++c)for(e=this.array[c],k=b.array[c],a=0;a<f;++a)d.array[c][a]=e[a]/k[a];return d};h.Matrix.prototype.scale=function(b){h.util.checkNumber(b);var d=new h.Matrix(this.nrows,this.ncols),c,a,e,k=this.nrows,g=this.ncols;if(m.unrollLoops){var f=g-3;for(c=0;c<k;++c){e=this.array[c];for(a=0;a<f;a+=4)d.array[c][a]=e[a]*b,d.array[c][a+1]=e[a+1]*b,d.array[c][a+2]=e[a+2]*b,d.array[c][a+
3]=e[a+3]*b;for(;a<g;++a)d.array[c][a]=e[a]*b}}else for(c=0;c<k;++c)for(e=this.array[c],a=0;a<g;++a)d.array[c][a]=e[a]*b;return d};h.Matrix.prototype.apply=function(b){h.util.checkFunction(b);var d=new h.Matrix(this.nrows,this.ncols),c,a,e,k=this.nrows,g=this.ncols;if(m.unrollLoops){var f=g-3;for(c=0;c<k;++c){e=this.array[c];for(a=0;a<f;a+=4)d.array[c][a]=b(e[a]),d.array[c][a+1]=b(e[a+1]),d.array[c][a+2]=b(e[a+2]),d.array[c][a+3]=b(e[a+3]);for(;a<g;++a)d.array[c][a]=b(e[a])}}else for(c=0;c<k;++c)for(e=
this.array[c],a=0;a<g;++a)d.array[c][a]=b(e[a]);return d};h.Matrix.prototype.transpose=function(){var b=new h.Matrix(this.ncols,this.nrows),d,c,a,e=this.nrows,k=this.ncols;for(d=0;d<e;++d)for(a=this.array[d],c=0;c<k;++c)b.array[c][d]=a[c];return b};h.Matrix.prototype.transposeInPlace=function(){if(this.isSquare()){var b,d,c=this.nrows,a=this.ncols;for(b=0;b<c;++b)for(d=b+1;d<a;++d){var e=this.array[b][d];this.array[b][d]=this.array[d][b];this.array[d][b]=e}}else throw Error("In place transpose only available for square matrices.");
return this};h.Matrix.prototype.dotVector=function(b){h.util.checkMatrixVector(this,b);var d=new h.Vector(this.nrows),c,a,e,k=this.nrows,g=this.ncols,f;if(m.unrollLoops){var l=g-3;for(a=0;a<k;++a){c=0;f=this.array[a];for(e=0;e<l;e+=4)c+=f[e]*b.array[e]+f[e+1]*b.array[e+1]+f[e+2]*b.array[e+2]+f[e+3]*b.array[e+3];for(;e<g;++e)c+=f[e]*b.array[e];d.array[a]=c}}else for(a=0;a<k;++a){c=0;f=this.array[a];for(e=0;e<g;++e)c+=f[e]*b.array[e];d.array[a]=c}return d};h.Matrix.prototype.dotMatrix=function(b){h.util.checkMatrixMatrix(this,
b);var d=new h.Matrix(this.nrows,b.ncols),c,a,e,k,g,f=this.nrows,l=this.ncols,p=b.ncols,n=new Float64Array(l);if(m.unrollLoops){var q=l-3;for(e=0;e<p;++e)for(b.copyColumn(e,n),c=0;c<f;++c){k=0;g=this.array[c];for(a=0;a<q;a+=4)k+=g[a]*n[a]+g[a+1]*n[a+1]+g[a+2]*n[a+2]+g[a+3]*n[a+3];for(;a<l;++a)k+=g[a]*n[a];d.array[c][e]=k}}else for(e=0;e<p;++e)for(b.copyColumn(e,n),c=0;c<f;++c){k=0;g=this.array[c];for(a=0;a<l;++a)k+=g[a]*n[a];d.array[c][e]=k}return d};h.Matrix.prototype.workerPlus=function(b,d,c){h.util.checkMatrices(this,
b);h.util.checkNullOrUndefined(d);var a=h.util.loadBalance(this.nrows),e=[],k=0,g,f,l,p,n,q=this.ncols;if(m.unrollLoops){var r=q-3;for(g=a.ifrom;g<a.ito;++g){e.push(new Float64Array(q));l=this.array[g];p=b.array[g];n=e[k];for(f=0;f<r;f+=4)n[f]=l[f]+p[f],n[f+1]=l[f+1]+p[f+1],n[f+2]=l[f+2]+p[f+2],n[f+3]=l[f+3]+p[f+3];for(;f<q;++f)n[f]=l[f]+p[f];++k}}else for(g=a.ifrom;g<a.ito;++g){e.push(new Float64Array(q));l=this.array[g];p=b.array[g];n=e[k];for(f=0;f<q;++f)n[f]=l[f]+p[f];++k}h.MathWorker.gatherMatrixRows(e,
this.nrows,a.ifrom,d,c)};h.Matrix.prototype.workerMinus=function(b,d,c){h.util.checkMatrices(this,b);h.util.checkNullOrUndefined(d);var a=h.util.loadBalance(this.nrows),e=[],k=0,g,f,l,p,n,q=this.ncols;if(m.unrollLoops){var r=q-3;for(g=a.ifrom;g<a.ito;++g){e.push(new Float64Array(q));l=this.array[g];p=b.array[g];n=e[k];for(f=0;f<r;f+=4)n[f]=l[f]-p[f],n[f+1]=l[f+1]-p[f+1],n[f+2]=l[f+2]-p[f+2],n[f+3]=l[f+3]-p[f+3];for(;f<q;++f)n[f]=l[f]-p[f];++k}}else for(g=a.ifrom;g<a.ito;++g){e.push(new Float64Array(q));
l=this.array[g];p=b.array[g];n=e[k];for(f=0;f<q;++f)n[f]=l[f]-p[f];++k}h.MathWorker.gatherMatrixRows(e,this.nrows,a.ifrom,d,c)};h.Matrix.prototype.workerTimes=function(b,d,c){h.util.checkMatrices(this,b);h.util.checkNullOrUndefined(d);var a=h.util.loadBalance(this.nrows),e=[],k=0,g,f,l,p,n,q=this.ncols;if(m.unrollLoops){var r=q-3;for(g=a.ifrom;g<a.ito;++g){e.push(new Float64Array(q));l=this.array[g];p=b.array[g];n=e[k];for(f=0;f<r;f+=4)n[f]=l[f]*p[f],n[f+1]=l[f+1]*p[f+1],n[f+2]=l[f+2]*p[f+2],n[f+
3]=l[f+3]*p[f+3];for(;f<q;++f)n[f]=l[f]*p[f];++k}}else for(g=a.ifrom;g<a.ito;++g){e.push(new Float64Array(q));l=this.array[g];p=b.array[g];n=e[k];for(f=0;f<q;++f)n[f]=l[f]*p[f];++k}h.MathWorker.gatherMatrixRows(e,this.nrows,a.ifrom,d,c)};h.Matrix.prototype.workerDivide=function(b,d,c){h.util.checkMatrices(this,b);h.util.checkNullOrUndefined(d);var a=h.util.loadBalance(this.nrows),e=[],k=0,g,f,l,p,n,q=this.ncols;if(m.unrollLoops){var r=q-3;for(g=a.ifrom;g<a.ito;++g){e.push(new Float64Array(q));l=this.array[g];
p=b.array[g];n=e[k];for(f=0;f<r;f+=4)n[f]=l[f]/p[f],n[f+1]=l[f+1]/p[f+1],n[f+2]=l[f+2]/p[f+2],n[f+3]=l[f+3]/p[f+3];for(;f<q;++f)n[f]=l[f]/p[f];++k}}else for(g=a.ifrom;g<a.ito;++g){e.push(new Float64Array(q));l=this.array[g];p=b.array[g];n=e[k];for(f=0;f<q;++f)n[f]=l[f]/p[f];++k}h.MathWorker.gatherMatrixRows(e,this.nrows,a.ifrom,d,c)};h.Matrix.prototype.workerScale=function(b,d,c){h.util.checkNumber(b);h.util.checkNullOrUndefined(d);var a=h.util.loadBalance(this.nrows),e=[],k=0,g,f,l,p,n=this.ncols;
if(m.unrollLoops){var q=n-3;for(g=a.ifrom;g<a.ito;++g){e.push(new Float64Array(n));l=this.array[g];p=e[k];for(f=0;f<q;f+=4)p[f]=l[f]*b,p[f+1]=l[f+1]*b,p[f+2]=l[f+2]*b,p[f+3]=l[f+3]*b;for(;f<n;++f)p[f]=l[f]*b;++k}}else for(g=a.ifrom;g<a.ito;++g){e.push(new Float64Array(n));l=this.array[g];p=e[k];for(f=0;f<n;++f)p[f]=l[f]*b;++k}h.MathWorker.gatherMatrixRows(e,this.nrows,a.ifrom,d,c)};h.Matrix.prototype.workerApply=function(b,d,c){h.util.checkFunction(b);h.util.checkNullOrUndefined(d);var a=h.util.loadBalance(this.nrows),
e=[],k=0,g,f,l,p,n=this.ncols;if(m.unrollLoops){var q=n-3;for(g=a.ifrom;g<a.ito;++g){e.push(new Float64Array(n));l=this.array[g];p=e[k];for(f=0;f<q;f+=4)p[f]=b(l[f]),p[f+1]=b(l[f+1]),p[f+2]=b(l[f+2]),p[f+3]=b(l[f+3]);for(;f<n;++f)p[f]=b(l[f]);++k}}else for(g=a.ifrom;g<a.ito;++g){e.push(new Float64Array(n));l=this.array[g];p=e[k];for(f=0;f<n;++f)p[f]=b(l[f]);++k}h.MathWorker.gatherMatrixRows(e,this.nrows,a.ifrom,d,c)};h.Matrix.prototype.workerDotVector=function(b,d,c){h.util.checkMatrixVector(this,
b);h.util.checkNullOrUndefined(d);var a=h.util.loadBalance(this.nrows),e=new Float64Array(a.ito-a.ifrom),k,g,f,l,p=this.ncols,n=0;if(m.unrollLoops){var q=p-3;for(k=a.ifrom;k<a.ito;++k){l=this.array[k];for(g=f=0;g<q;g+=4)f+=l[g]*b.array[g]+l[g+1]*b.array[g+1]+l[g+2]*b.array[g+2]+l[g+3]*b.array[g+3];for(;g<p;++g)f+=l[g]*b.array[g];e[n++]=f}}else for(k=a.ifrom;k<a.ito;++k){l=this.array[k];for(g=f=0;g<p;++g)f+=l[g]*b.array[g];e[n++]=f}h.MathWorker.gatherVector(e,b.length,a.ifrom,d,c)};h.Matrix.prototype.workerDotMatrix=
function(b,d,c){h.util.checkMatrixMatrix(this,b);h.util.checkNullOrUndefined(d);var a,e,k,g,f,l=this.nrows,p=this.ncols,n=h.util.loadBalance(b.ncols),q=n.ito-n.ifrom,r=Array(q);for(k=0;k<q;++k)r[k]=new Float64Array(l);var s=new Float64Array(p);if(m.unrollLoops){var t=p-3;for(k=0;k<q;++k)for(b.copyColumn(n.ifrom+k,s),a=0;a<l;++a){g=0;f=this.array[a];for(e=0;e<t;e+=4)g+=f[e]*s[e]+f[e+1]*s[e+1]+f[e+2]*s[e+2]+f[e+3]*s[e+3];for(;e<p;++e)g+=f[e]*s[e];r[k][a]=g}}else for(k=0;k<q;++k)for(b.copyColumn(n.ifrom+
k,s),a=0;a<l;++a){g=0;f=this.array[a];for(e=0;e<p;++e)g+=f[e]*s[e];r[k][a]=g}h.MathWorker.gatherMatrixColumns(r,this.nrows,b.ncols,n.ifrom,d,c)};h.Batch={};h.Batch.workerVectorLinearCombination=function(b,d,c,a){h.util.checkNumber(d[0]);h.util.checkVector(b[0]);h.util.checkNullOrUndefined(c);var e,k,g,f=0,l=b[0],p=d[0],n=h.util.loadBalance(l.length),q=new Float64Array(n.ito-n.ifrom);if(m.unrollLoops)for(g=n.ito-3,e=n.ifrom;e<g;++e)q[f++]=p*l.array[e],q[f++]=p*l.array[e+1],q[f++]=p*l.array[e+2],q[f++]=
p*l.array[e+3];else e=n.ifrom;for(;e<n.ito;++e)q[f++]=p*l.array[e];for(k=1;k<b.length;++k){f=0;l=b[k];p=d[k];h.util.checkNumber(p);h.util.checkVectors(b[k-1],l);if(m.unrollLoops)for(e=n.ifrom;e<g;++e)q[f++]+=p*l.array[e],q[f++]+=p*l.array[e+1],q[f++]+=p*l.array[e+2],q[f++]+=p*l.array[e+3];else e=n.ifrom;for(;e<n.ito;++e)q[f++]+=p*l.array[e]}h.MathWorker.gatherVector(q,l.length,n.ifrom,c,a)};h.Batch.workerMatrixLinearCombination=function(b,d,c,a){h.util.checkNumber(d[0]);h.util.checkMatrix(b[0]);h.util.checkNullOrUndefined(c);
for(var e=[],k=0,g=b[0],f=d[0],l=h.util.loadBalance(b[0].nrows),p=l.ifrom;p<l.ito;++p){e.push(new Float64Array(g.ncols));for(var n=0;n<g.ncols;++n)e[k][n]=f*g.array[p][n];++k}for(var m=1;m<b.length;++m)for(k=0,g=b[m],f=d[m],h.util.checkNumber(f),h.util.checkMatrices(b[m-1],g),p=l.ifrom;p<l.ito;++p){for(n=0;n<g.ncols;++n)e[k][n]+=f*g.array[p][n];++k}h.MathWorker.gatherMatrixRows(e,g.nrows,l.ifrom,c,a)};h.Batch.workerMatrixVectorPlus=function(b,d,c,a,e,k,g){h.util.checkNumber(b);h.util.checkMatrixVector(d,
c);h.util.checkNullOrUndefined(a);var f=h.util.loadBalance(d.nrows),l=new Float64Array(f.ito-f.ifrom),p=0;if(k&&g){h.util.checkNumber(k);h.util.checkVectors(c,g);for(var n=f.ifrom;n<f.ito;++n){for(var m=0,r=0;r<this.ncols;++r)m+=d.array[n][r]*v.array[r];l[p++]=b*m+k*g[n]}}else for(n=f.ifrom;n<f.ito;++n){for(r=m=0;r<this.ncols;++r)m+=d.array[n][r]*v.array[r];l[p++]=b*m}h.MathWorker.gatherVector(l,c.length,f.ifrom,a,e)};h.Batch.workerMatrixMatrixPlus=function(b,d,c,a,e,k,g){h.util.checkNumber(b);h.util.checkMatrixMatrix(d,
c);h.util.checkNullOrUndefined(a);var f=c.isSquare()?c.transposeInPlace():c.transpose(),l=h.util.loadBalance(d.nrows),p=[],n=0;if(k&&g){h.util.checkNumber(k);h.util.checkMatrix(g);if(d.nrows!==g.nrows||c.ncols!==g.ncols)throw Error("Matrix dimensions not compatible for addition.");for(var m=l.ifrom;m<l.ito;++m){p.push(new Float64Array(c.ncols));for(var r=0;r<c.ncols;++r){for(var s=0,t=0;t<d.ncols;++t)s+=d.array[m][t]*f.array[r][t];p[n][r]=b*s+k*g.array[m][r]}++n}}else for(m=l.ifrom;m<l.ito;++m){p.push(new Float64Array(c.ncols));
for(r=0;r<c.ncols;++r){for(t=s=0;t<d.ncols;++t)s+=d.array[m][t]*f.array[r][t];p[n][r]=b*s}++n}c.isSquare&&c.transposeInPlace();h.MathWorker.gatherMatrixRows(p,d.nrows,l.ifrom,a,e)};h.Stats={};h.Stats.summary=function(b){function d(b,c){var d=c-b+1,e=d/2|0,d=d%2;return{median:d?a[b+e]:.5*(a[b+e-1]+a[b+e]),half:e,odd:d}}h.util.checkNullOrUndefined(b);var c,a=[];if(b instanceof h.Vector)for(c=0;c<b.array.length;++c)a.push(b.array[c]);else if(b instanceof h.Matrix)for(c=0;c<b.nrows;++c)for(var e=0;e<
b.ncols;++e)a.push(b.array[c][e]);else if(b instanceof Array||b instanceof Float64Array)for(c=0;c<b.length;++c)a.push(b[c]);else throw new TypeError("Invalid data type for summary(). Must be Array, Float64Array, or Vector.");var k,g=a.length,f=0;b=Math.max.apply(Math,a);e=Math.min.apply(Math,a);for(c=0;c<g;++c)f+=a[c];var f=f/g,l=0;for(c=0;c<g;++c)k=f-a[c],l+=k*k;l/=g;c=Math.sqrt(l);var m,n,q;3<=g&&(a.sort(function(a,b){return a-b}),m=d(0,g-1),n=m.median,g=d(m.half,g-1),q=g.median,g=m.odd?d(0,m.half):
d(0,m.half-1),m=g.median);return{n:a.length,mean:f,variance:l,stddev:c,minimum:e,maximum:b,quartile25:m,quartile50:n,quartile75:q}};return h}();
